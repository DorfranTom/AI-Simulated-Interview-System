@startuml
title 模拟面试流程时序图

actor 候选人 as Candidate
participant "面试控制器" as Controller
participant "面试服务" as Service
participant "问题生成器" as Generator
participant "通义千问API" as TongyiAPI
participant "数据库" as DB

Candidate -> Controller: 创建面试会话
Controller -> Service: startInterview()
Service -> Generator: generateInitialQuestions()
Generator -> TongyiAPI: 请求初始问题
TongyiAPI --> Generator: 返回问题列表
Generator --> Service: 返回问题列表
Service -> DB: 保存面试会话和问题
DB --> Service: 保存成功

loop 多轮问答
    Candidate -> Controller: 提交回答
    Controller -> Service: submitAnswer()
    Service -> DB: 获取当前问题
    DB --> Service: 返回问题
    Service -> Generator: generateFollowUpQuestion()
    Generator -> TongyiAPI: 请求追问
    TongyiAPI --> Generator: 返回追问
    Generator --> Service: 返回追问
    Service -> DB: 保存回答和新问题
    DB --> Service: 保存成功
end

Candidate -> Controller: 结束面试
Controller -> Service: completeInterview()
Service -> DB: 获取所有问题和回答
DB --> Service: 返回数据
Service -> "评估器": evaluateAnswers()
"评估器" -> TongyiAPI: 请求回答评估
TongyiAPI --> "评估器": 返回评估结果
"评估器" --> Service: 返回评估结果
Service -> "报告生成器": generateReport()
"报告生成器" --> Service: 返回报告
Service -> DB: 保存面试报告
DB --> Service: 保存成功
Service --> Controller: 返回完成确认
Controller --> Candidate: 显示面试报告
@enduml